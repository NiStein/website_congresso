<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inscrição</title>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
    <link rel="stylesheet" href="css/form.css">
    <link rel="shortcut icon" href="assets/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon-16x16.png">
    <link rel="manifest" href="assets/site.webmanifest">
</head>
<body>
    <main>
        <section class="container">
            <header>
                <h1>Congresso Acadêmico: Inscrições</h1>
                <p>Local: Teatro do SESC - Centro Cultural</p>
                <p>Data: 27 a 30 de Maio de 2025</p>
            </header>
            <form class="form" name="submit-to-google-sheet" id="inscricao-form" action="#" method="post" autocomplete="on">
                <div class="input-box">
                    <div class="box-itens">
                        <span class="material-symbols-outlined">person</span>
                        <label class="subtitle" for="nome">Nome Completo</label>
                    </div>
                    <input type="text" name="nome" id="nome" placeholder="Insira o Nome Completo" autocomplete="name" required maxlength="70">
                </div>
                <div class="input-box">
                    <div class="box-itens">
                        <span class="material-symbols-outlined">email</span>
                        <label class="subtitle" for="email">Email</label>
                    </div>
                    <input type="email" name="email" id="email" placeholder="Email" autocomplete="email" required maxlength="30">
                </div>

                <div class="input-box">
                    <div class="box-itens">
                        <span class="material-symbols-outlined">phone</span>
                        <label class="subtitle" for="telefone">Telefone</label>
                    </div>
                    <input type="tel" name="telefone" id="telefone" placeholder="Telefone: (xx) xxxxx-xxxx" autocomplete="tel" required maxlength="15">
                </div>

                <div class="selecao-box">
                    <h3>Selecione as suas Inscrições</h3>
                    <div class="all">

                        <h4>1.0 Inscrição para as Atividades Gerais do CONIAD</h4>
                        <div class="selecao-geral">
                            <div class="seletor">
                                <input class="input-inscricao" type="radio" id="geral-sim" name="geral" checked/>
                                <label for="geral-sim">Sim</label>
                            </div>

                            <div class="seletor">
                                <input class="input-inscricao" type="radio" id="geral-nao" name="geral"/>
                                <label for="geral-nao">Não</label>
                            </div>
                        </div>

                        <h4>2.0 Inscrições para as Oficinas</h4>
                        <div class="selecao-oficina">

                            <div class="seletor">
                                <input class="input-inscricao" type="checkbox" id="oficina1" name="oficina" checked>
                                <label for="oficina1">Oficina I</label>
                            </div>

                            <div class="seletor">
                                <input class="input-inscricao" type="checkbox" id="oficina2" name="oficina2">
                                <label for="oficina2">Oficina II</label>
                            </div>

                            <div class="seletor">
                                <input class="input-inscricao" type="checkbox" id="oficina3" name="oficina3">
                                <label for="oficina3">Oficina III</label>
                            </div>

                            <div class="seletor">
                                <input class="input-inscricao"type="checkbox" id="oficina4" name="oficina4" >
                                <label for="oficina4">Oficina IV</label>
                            </div>
                        </div>

                        <h4>3.0 Inscrição para o Trabalho Cientifíco</h4>
                        <div class="selecao-trabalho">
                            <div class="seletor">
                                <input class="input-inscricao" type="radio" id="trabalho-sim" name="trabalho" checked/>
                                <label for="trabalho-sim">Sim</label>
                            </div>

                            <div class="seletor">                       
                                <input class="input-inscricao" type="radio" id="trabalho-nao" name="trabalho"/>
                                <label for="trabalho-nao">Não</label>
                            </div>
                        </div>
                    </div>

                </div>

        
                <div class="input-box">
                    <div class="box-itens">
                        <span class="material-symbols-outlined">list</span>
                        <label class="subtitle" for="categoria">Categoria</label>
                    </div>
                    <div class="column">
                        <div class="select-box">
                            <select name="categoria" id="categoria" class="select" required>
                                <option value="" hidden>Selecione a categoria</option>
                                <option value="estudante">Estudante</option>
                                <option value="demais">Demais</option>
                            </select>
                        </div>
                    </div>
                </div>
        
                <div class="btns">
                    <button class="submitBTN" type="submit">Enviar</button>
                    <button class="backBTN" id="back-button" title="Voltar" onclick="window.history.back()">
                        <span class="material-symbols-outlined">arrow_back</span>
                    </button>
                </div>
            </form>
        </section>
    </main>


    <script>
        
        document.addEventListener('DOMContentLoaded', function () {
            const telefoneInput = document.getElementById('telefone');

            telefoneInput.addEventListener('input', function (e) {
                let valor = e.target.value.replace(/\D/g, '');
                let formato = '';

                if (valor.length > 6) {
                    formato = `(${valor.substring(0, 2)}) ${valor.substring(2, 7)}-${valor.substring(7, 11)}`;
                } else if (valor.length > 2) {
                    formato = `(${valor.substring(0, 2)}) ${valor.substring(2, 7)}`;
                } else {
                    formato = `(${valor.substring(0, 2)}`;
                }

                e.target.value = formato;
            });

            telefoneInput.addEventListener('blur', function (e) {
                let valor = e.target.value.replace(/\D/g, '');
                let formato = '';

                if (valor.length >= 10) {
                    formato = `(${valor.substring(0, 2)}) ${valor.substring(2, 7)}-${valor.substring(7, 11)}`;
                } else if (valor.length >= 6) {
                    formato = `(${valor.substring(0, 2)}) ${valor.substring(2, 7)}`;
                } else {
                    formato = `(${valor.substring(0, 2)}`;
                }

                e.target.value = formato;
            });

            const form = document.getElementById('inscricao-form');
            form.addEventListener('submit', function (e) {
                const telefone = document.getElementById('telefone').value;
                const telefoneValido = /^\(\d{2}\) \d{5}-\d{4}$/.test(telefone);

                if (!telefoneValido) {
                    e.preventDefault();
                    alert('Por favor, insira um número de telefone válido no formato (xx) xxxxx-xxxx.');
                } else {
                    const categoria = document.getElementById('categoria').value;
                    let url = '';
                    const hoje = new Date();

                    if (categoria === 'estudante') {
                        if (hoje <= new Date('2024-10-31')) {
                            url = 'https://mpago.la/1T5Cu6D'; // 1 lote estudante
                        } else if (hoje <= new Date('2024-12-31')) {
                            url = 'https://mpago.la/2aZWrPt'; // 2 lote estudante
                        } else if (hoje <= new Date('2025-02-28')) {
                            url = 'https://mpago.la/1SDRAvy'; // 3 lote estudante
                        } else {
                            url = 'https://mpago.la/115ZGp4'; // 4 lote estudante
                        }
                    } else {
                        if (hoje <= new Date('2024-10-31')) {
                            url = 'https://mpago.la/2mxvG7w'; // 1 lote demais
                        } else if (hoje <= new Date('2024-12-31')) {
                            url = 'https://mpago.la/1FsY9dD'; // 2 lote demais
                        } else if (hoje <= new Date('2025-02-28')){
                            url = 'https://mpago.la/145cAAq'; // 3 lote demais
                        } else {
                            url = 'https://mpago.la/1N3Yurm'; // 4 lote demais
                        }
                    }

                    exibirMensagemESucesso(url);
                }
            });
        });

        function exibirMensagemESucesso(link) {
            const mainContent = document.querySelector('main');
            mainContent.innerHTML = `
            <div id="sucesso">
                <h1>Inscrição realizada com sucesso!</h1>
                <p>Redirecionando para o pagamento...</p>
            </div>`;

            setTimeout(function () {
                window.location.href = link;
            }, 5000);
        }

        const scriptURL = 'https://script.google.com/macros/s/AKfycbwrNm8r9OvoBCS0HrurjTwZWZKlFeicXNflO1IwShFXRUDdZDrcjllYQwskj4P-sHt2Bg/exec';
        const form = document.forms['submit-to-google-sheet']; // formulario no index

        form.addEventListener('submit', e =>
        {
            e.preventDefault();

            var formData = new FormData(form);
            var data = {};

            for (var [key, value] of formData.entries())
            {
                data[key] = value;
            }
            data_result = JSON.stringify(data);

            fetch(scriptURL, { method: 'POST', body: data_result})
            .then(response =>
            {
                //alert("Feito! formulario adicionado a planilha.");
            })
            .catch(error =>
            {
                //alert("Ops. Não conseguimos receber o formulário, tente novamente ou verifique o problema");
                console.error(error);
            })
        });
    </script>
</body>
</html>